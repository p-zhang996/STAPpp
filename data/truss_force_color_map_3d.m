%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
%  绘制桁架结构杆内分布  三维版本
%     2025.09.16
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% 节点坐标 (示例)
Node = ...
[ 5.00000e+01    5.00000e+01    0.00000e+00
 -5.00000e+01    5.00000e+01    0.00000e+00
 -5.00000e+01   -5.00000e+01    0.00000e+00
  5.00000e+01   -5.00000e+01    0.00000e+00
  3.00000e+01    3.00000e+01    5.00000e+01
 -3.00000e+01    3.00000e+01    5.00000e+01
 -3.00000e+01   -3.00000e+01    5.00000e+01
  3.00000e+01   -3.00000e+01    5.00000e+01
  1.50000e+01    1.50000e+01    1.00000e+02
 -1.50000e+01    1.50000e+01    1.00000e+02
 -1.50000e+01   -1.50000e+01    1.00000e+02
  1.50000e+01   -1.50000e+01    1.00000e+02
  5.00000e+00    5.00000e+00    1.50000e+02
 -5.00000e+00    5.00000e+00    1.50000e+02
 -5.00000e+00   -5.00000e+00    1.50000e+02
  5.00000e+00   -5.00000e+00    1.50000e+02
  0.00000e+00    0.00000e+00    3.00000e+02
];

% 杆件连接 (示例)
Element = [  5        6
  6        7
  7        8
  8        5
  9       10
 10       11
 11       12
 12        9
 13       14
 14       15
 15       16
 16       13
  1        5
  5        9
  9       13
  2        6
  6       10
 10       14
  3        7
  7       11
 11       15
  4        8
  8       12
 12       16
 13       17
 14       17
 15       17
 16       17
  1        6
  2        7
  3        8
  4        5
  5       10
  6       11
  7       12
  8        9
  9       14
 10       15
 11       16
 12       13
  5        7
  6        8
  9       11
 10       12
 13       15
 14       16
];

% 每根杆的内力 (示例数据)
N = [  6.70833e+03
 -1.45833e+03
 -6.70833e+03
  1.45833e+03
  8.16667e+03
 -2.33333e+03
 -8.16667e+03
  2.33333e+03
  8.75000e+03
 -8.75000e+03
 -8.75000e+03
  8.75000e+03
  1.67550e+04
  2.53465e+04
  5.45596e+04
 -1.20636e+04
 -1.58416e+04
 -2.42487e+04
 -1.67550e+04
 -2.53465e+04
 -5.45596e+04
  1.20636e+04
  1.58416e+04
  2.42487e+04
  5.25583e+04
 -5.25583e+04
 -5.25583e+04
  5.25583e+04
 -7.87565e+03
 -2.44472e-11
  7.87565e+03
  1.04774e-11
 -1.20610e+04
 -1.39698e-11
  1.20610e+04
 -2.56114e-11
 -3.19505e+04
  9.31323e-12
  3.19505e+04
 -2.60770e-10
  5.23869e-12
  4.65661e-12
  2.32831e-11
  9.31323e-12
  3.72529e-11
 -3.72529e-11
];  

% 颜色映射
cmap = jet(256); % 使用 jet 色带
cmin = min(N);
cmax = max(N);

figure; 
hold on; axis equal; box on; grid on;

for e = 1:size(Element,1)
    i = Element(e,1);
    j = Element(e,2);
    x = [Node(i,1), Node(j,1)];
    y = [Node(i,2), Node(j,2)];
    z = [Node(i,3), Node(j,3)];

    % 当前内力值
    val = N(e);
    % 映射到 colormap
    idx = round((val - cmin)/(cmax - cmin) * (size(cmap,1)-1)) + 1;
    plot3(x, y, z, 'LineWidth', 3, 'Color', cmap(idx,:));
    
end
% 绘制节点
plot3(Node(:,1), Node(:,2), Node(:,3), 'ko', 'MarkerFaceColor','k');

% 添加标题
title('Internal force');
xlabel('X(m)'); ylabel('Y(m)'); zlabel('Z(m)');

% 绘图区域
% coeff = 1.2;
% cent_x = (max(Node(:,1)) + min(Node(:,1)))/2;
% cent_y = (max(Node(:,2)) + min(Node(:,2)))/2;
% width  = (max(Node(:,1)) - min(Node(:,1)))/2;
% height = (max(Node(:,2)) - min(Node(:,2)))/2;
% xlim([cent_x -  width * coeff, cent_x +  width * coeff]);
% % ylim([cent_y - height * coeff, cent_y + height * coeff]);

% 添加 colorbar
colormap(cmap);
caxis([cmin cmax]);
hc = colorbar;
hc.Label.String = 'Force (N)';

% 图片调整
ax = gca;
ax.FontName = 'Times New Roman';
ax.FontSize = 18;
ax.LineWidth = 1.5;









